<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Random Japan Station</title>
  <style>
    :root { color-scheme: light dark; }
    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;
      margin:0; min-height:100vh; display:grid; place-items:center; padding:24px;
    }
    .card{ width:min(820px,100%); border:1px solid rgba(127,127,127,.25); border-radius:16px; padding:24px; }
    h1{ margin:0 0 14px; font-size:18px; opacity:.8; font-weight:600; }
    .name{
      font-size: clamp(40px, 7vw, 76px);
      line-height: 1.05;
      font-weight: 900;
      letter-spacing: .02em;
      margin: 8px 0 10px;
      display: inline-block;
    }
    .addr{
      font-size: clamp(14px, 2.2vw, 18px);
      opacity: .75;
      margin: 0 0 18px;
      display: inline-block;
    }
    .clickable{
      cursor: pointer;
      user-select: none;
      border-radius: 12px;
      padding: 6px 10px;
      margin-left: -10px; /* make padding feel centered */
      margin-right: 6px;
    }
    .clickable:hover{ background: rgba(127,127,127,.10); }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    button{
      cursor:pointer; font-size:16px; padding:10px 14px; border-radius:12px;
      border:1px solid rgba(127,127,127,.35); background:transparent;
    }
    button:hover{ background: rgba(127,127,127,.10); }
    .meta{ font-size: 13px; opacity:.7; margin-top: 10px; }
    .toast{
      position: fixed; left: 50%; bottom: 20px; transform: translateX(-50%);
      padding: 10px 14px; border-radius: 999px;
      border: 1px solid rgba(127,127,127,.35);
      background: rgba(0,0,0,.10);
      backdrop-filter: blur(8px);
      opacity: 0; pointer-events: none;
      transition: opacity .18s ease;
      font-size: 14px;
    }
    .toast.show{ opacity: 1; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Random Japan Station</h1>

    <div id="name" class="name clickable" title="Click to copy name">Loading…</div>
    <div><span id="addr" class="addr clickable" title="Click to copy address"></span></div>

    <div class="row">
      <button id="btn">Next</button>
    </div>

    <div id="meta" class="meta"></div>
  </div>

  <div id="toast" class="toast">Copied</div>

  <script>
    function randInt(n){ return Math.floor(Math.random() * n); }

    let places = [];
    let lastIdx = -1;

    async function loadPlaces(){
      const res = await fetch("./stations_with_address.json", {cache: "no-store"});
      if(!res.ok) throw new Error("Failed to load stations_with_address.json");
      const data = await res.json();
      if(!Array.isArray(data) || data.length === 0) throw new Error("JSON is empty");
      places = data;
    }

    function showToast(msg){
      const t = document.getElementById("toast");
      t.textContent = msg;
      t.classList.add("show");
      clearTimeout(showToast._timer);
      showToast._timer = setTimeout(()=>t.classList.remove("show"), 900);
    }

    async function copyText(text, label){
      text = (text || "").trim();
      if(!text){
        showToast("Nothing to copy");
        return;
      }
      try{
        await navigator.clipboard.writeText(text);
      }catch(e){
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
      }
      showToast(`Copied ${label}`);
    }

    function render(idx){
      const p = places[idx];
      const nameEl = document.getElementById("name");
      const addrEl = document.getElementById("addr");
      nameEl.textContent = p.name || "";
      addrEl.textContent = p.address || "";
      document.getElementById("meta").textContent = `#${idx+1} / ${places.length}`;
      document.title = (p.name || "Random Place") + " · Random Place";

      // store for click-copy
      nameEl.dataset.copy = p.name || "";
      addrEl.dataset.copy = p.address || "";
    }

    function roll(){
      if(places.length === 0) return;
      let idx = randInt(places.length);
      if(places.length > 1){
        while(idx === lastIdx) idx = randInt(places.length);
      }
      lastIdx = idx;
      render(idx);
    }

    (async () => {
      try{
        await loadPlaces();
        roll();
      }catch(err){
        document.getElementById("name").textContent = "Load failed";
        document.getElementById("addr").textContent = String(err);
        console.error(err);
      }
    })();

    document.getElementById("btn").addEventListener("click", roll);

    document.getElementById("name").addEventListener("click", (e)=>copyText(e.currentTarget.dataset.copy, "name"));
    document.getElementById("addr").addEventListener("click", (e)=>copyText(e.currentTarget.dataset.copy, "address"));

    window.addEventListener("keydown", (e) => {
      if(e.key === "r" || e.key === "R") roll();
      if(e.key === "n" || e.key === "N") roll();
      if(e.key === "c" || e.key === "C"){
        // copy name by default
        copyText(document.getElementById("name").dataset.copy, "name");
      }
    });
  </script>
  <p>Credit: <a href="https://ekidata.jp/">https://ekidata.jp/</a></p>
</body>
</html>
