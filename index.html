<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Interactive Trifold Brochure</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    #file-input {
      margin-bottom: 1em;
    }
    #status {
      margin-bottom: 1em;
      color: #333;
    }
    .brochure-container {
      margin-bottom: 3em;
    }
    .brochure-container h2 {
      margin: 0.5em 0;
    }
    .brochure {
      display: flex;
      perspective: 2000px;
      background: #fff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .panel {
      position: relative;
      backface-visibility: hidden;
      background-size: cover;
      background-position: center;
      transition: transform 1s;
      cursor: pointer;
    }
    /* 折叠折叠效果和各面 Transform 原点 */
    .panel:nth-child(1) { transform-origin: right center; }
    .panel:nth-child(3) { transform-origin: left center; }
    .folded-right { transform: rotateY(150deg); }
    .folded-left  { transform: rotateY(-150deg); }
  </style>
</head>
<body>
  <input type="file" id="file-input" accept="application/pdf" />
  <div id="status">请选择一个两页 PDF 文件。</div>

  <div class="brochure-container">
    <h2>正面 (Front)</h2>
    <div id="brochure-front" class="brochure"></div>
  </div>
  <div class="brochure-container">
    <h2>背面 (Back)</h2>
    <div id="brochure-back" class="brochure"></div>
  </div>

  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script>
    const input = document.getElementById('file-input');
    const status = document.getElementById('status');
    const front = document.getElementById('brochure-front');
    const back  = document.getElementById('brochure-back');
    pdfjsLib.GlobalWorkerOptions.workerSrc = 
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

    input.addEventListener('change', async () => {
      front.innerHTML = '';
      back.innerHTML  = '';
      const file = input.files[0];
      if (!file) return;
      status.textContent = '读取文件，将加载 PDF…';
      const arrayBuffer = await file.arrayBuffer();
      try {
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        if (pdf.numPages < 2) {
          status.textContent = 'PDF 必须至少包含两页。';
          return;
        }
        status.textContent = 'PDF 加载成功，共 ' + pdf.numPages + ' 页。正在渲染…';
        // 渲染第 1 页为正面，第 2 页为背面
        await renderPage(pdf, 1, front);
        await renderPage(pdf, 2, back);
        status.textContent = '渲染完成！点击左右两边面板即可折叠/展开。';
      } catch (e) {
        console.error(e);
        status.textContent = '加载 PDF 时出错：' + e.message;
      }
    });

    async function renderPage(pdf, pageNum, container) {
      const page = await pdf.getPage(pageNum);
      // 根据页面宽度缩放
      const scale = 1.5;
      const viewport = page.getViewport({ scale });
      // 渲染整页到临时 Canvas
      const tmpCanvas = document.createElement('canvas');
      tmpCanvas.width  = viewport.width;
      tmpCanvas.height = viewport.height;
      const ctx = tmpCanvas.getContext('2d');
      await page.render({ canvasContext: ctx, viewport }).promise;

      // 每页切成 3 个面板
      const panelWidth  = Math.floor(tmpCanvas.width / 3);
      const panelHeight = tmpCanvas.height;
      for (let i = 0; i < 3; i++) {
        // 切割子 Canvas
        const panelCanvas = document.createElement('canvas');
        panelCanvas.width  = panelWidth;
        panelCanvas.height = panelHeight;
        const pctx = panelCanvas.getContext('2d');
        pctx.drawImage(
          tmpCanvas,
          i * panelWidth, 0, panelWidth, panelHeight,
          0, 0, panelWidth, panelHeight
        );
        // 生成面板 DIV
        const div = document.createElement('div');
        div.className = 'panel';
        div.style.width  = panelWidth + 'px';
        div.style.height = panelHeight + 'px';
        div.style.backgroundImage = `url(${panelCanvas.toDataURL()})`;
        // 点击折叠/展开
        if (i === 0) {
          div.addEventListener('click', () => div.classList.toggle('folded-right'));
        } else if (i === 2) {
          div.addEventListener('click', () => div.classList.toggle('folded-left'));
        }
        container.appendChild(div);
      }
    }
  </script>
</body>
</html>
